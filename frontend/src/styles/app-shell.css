/* ==========================================================================
   APP SHELL: stage background, blade, header, footer
   ========================================================================== */

/* Wallpaper stage (video or image) */
.stage {
  position: relative;
  height: 100dvh;
  min-height: 100dvh;
  width: 100%;
  padding: .5cm;
  background-color: var(--app-wallpaper); /* let inline background-image win */
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
}
.stage-video-wrap { position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden; }
.stage-video {
  position: absolute; left: 50%; top: 50%;
  transform: translate(-50%, -50%) rotate(270deg);
  transform-origin: center center;
  width: 100vmax; height: 100vmax; object-fit: cover; filter: none;
}
.stage-overlay {
  position: fixed; inset: 0; z-index: 1; pointer-events: none;
  background: rgb(var(--stage-overlay-color) / var(--stage-overlay-opacity));
}

/* App blade */
.app-blade {
  position: relative; z-index: 2;
  height: calc(100dvh - 1cm);
  min-height: calc(100dvh - 1cm);
  border-radius: 20px;
  background: var(--bg);
  border: 1px solid var(--border);
  box-shadow: 0 20px 60px rgba(0,0,0,.22);
  overflow: hidden;
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
}

/* In-blade floating layer for portals (Select etc.) */
#blade-floating-root { position: absolute; inset: 0; z-index: 12; pointer-events: none; }

/* App grid */
.app-root { display: grid; grid-template-rows: auto 1fr auto; min-height: 100%; height: 100%; }

/* Header */
.header {
  position: sticky; top: 0; z-index: 5;
  background: var(--card);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 16px;
  border-top-left-radius: 20px; border-top-right-radius: 20px;
  backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur));
}
.header .logo { height: 28px }
.header .menu-3lines {
  background: none; border: none; padding: 8px;
  display: inline-flex; flex-direction: column; gap: 3px; cursor: pointer
}
.header .menu-3lines span { width: 18px; height: 2px; background: var(--text); opacity: .8; transition: .2s }
.header .menu-3lines:hover span { opacity: 1; }

.main { padding: 16px; min-height: 0; flex: 1 1 auto; }
.public-main { max-width: 860px; margin: 0 auto; width: 100%; min-height: 0; }

/* Transparent chrome mode */
.chrome-transparent .app-blade,
.app-blade:has(> .app-root.chrome-transparent) {
  background: transparent !important; border: none !important;
  box-shadow: none !important; backdrop-filter: none !important; -webkit-backdrop-filter: none !important;
  border-radius: 0 !important; overflow: visible !important;
}
.chrome-transparent .header { background: transparent; border-bottom: none; backdrop-filter: none; -webkit-backdrop-filter: none; }
.chrome-transparent .sidebar { background: transparent; border-right: none; backdrop-filter: none; -webkit-backdrop-filter: none; }

/* Header micro-interactions (keep even in chrome-transparent) */
.chrome-transparent .header .logo { transition: transform .18s ease, filter .18s ease; filter: drop-shadow(0 2px 6px rgba(0,0,0,.18)); }
.chrome-transparent .header .logo:hover { transform: translateY(-1px) scale(1.02) }
.chrome-transparent .header .menu-3lines { border-radius: 10px; transition: transform .15s ease, box-shadow .15s ease, background-color .15s ease; }
.chrome-transparent .header .menu-3lines:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,.18); background: rgb(var(--glass-component-2-rgb) / .12); }
.chrome-transparent .header .menu-3lines:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; box-shadow: 0 0 0 6px rgb(var(--glass-component-2-rgb) / .18); }

/* Footer */
.logo-small { height: 14px; transform: translate(7px, 1px); }
.footer {
  border-top: 1px solid var(--border);
  background: var(--card);
  margin-top: auto;
  backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur));
}
.footer .footer-inner {
  display: flex; align-items: center; justify-content: center; gap: 10px;
  padding: 10px 16px; text-align: center;
}
.public-main + .footer { background: transparent; border-top: none; backdrop-filter: none; -webkit-backdrop-filter: none; }
